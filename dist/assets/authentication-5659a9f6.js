import{a as t}from"./axios-ffe46ef9.js";import{u as w}from"./execute-06bfbd1f.js";import{u as y}from"./vue-router-f46e3a9b.js";import{F as u}from"./runtime-core.esm-bundler-cfb3c51b.js";function I(){const i=u(""),n=y(),s=u(""),{confirm:p,accepted:r,rejected:o}=w();async function d(a){try{await t.get("/sanctum/csrf-cookie");const e=await t.post("/api/login",a),k=await e.data.content.access_token,_=await e.data.content.is_member;await e.data.content.is_verified===0?n.push({name:"OTP",params:{phone:e.data.content.phone}}):(r("Selamat Datang"),n.push("/beranda"),v(k))}catch(e){e.response.status===401&&(s.value=e.response.data.message,o(s.value)),e.response.status===422&&(s.value=e.response.data.errors),e.response.status===500&&o("Server In Trouble call your administrator")}}async function l(a){try{await t.get("/sanctum/csrf-cookie");const e=await t.post("/api/register",a);n.push({name:"OTP",params:{phone:e.data.content.phone}}),r("Pendaftaran Anda Berhasil, Silakan Masukkan Kode OTP")}catch(e){e.response.status===401&&(s.value=e.response.data.message,o(s.value)),e.response.status===422&&o(e.response.data.message),e.response.status===500&&o("Server In Trouble call your administrator")}}async function f(a){try{await t.post("/api/verify_otp",a),n.push("/login"),r("Pendaftaran Anda Berhasil, Silakan Melakukan Login")}catch(e){e.response.status===401&&(s.value=e.response.data.message,o(s.value)),e.response.status===422&&o(e.response.data.message),e.response.status===500&&o(e.response.data)}}async function m(){try{const a=await t.get("/api/profile");i.value=await a.data,a.data.is_verified===0&&n.push("/otp/"+a.data.phone)}catch(a){c(),a.response.status===401&&n.push("/login")}}async function h(){if((await p("Apa anda ingin keluar?")).isConfirmed)try{await t.get("/api/logout"),c(),n.push("/login"),await r("Anda telah keluar")}catch(e){console.log(e)}}async function g(a){try{await t.post("api/profile/update",a),window.location.reload(),isLoading.value=!1}catch(e){console.log(e)}}function v(a){localStorage.setItem("access_token",a),t.defaults.headers.common.Authorization=`Bearer ${a}`}function c(){delete t.defaults.headers.common.Authorization,localStorage.removeItem("access_token")}return{auth:i,errors:s,doLogin:d,doLogout:h,checkOtp:f,doRegister:l,doUpdate:g,getAuth:m}}export{I as u};
